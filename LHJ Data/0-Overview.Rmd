---
title: "Overview of Process for Generating LHJ Population Data"
author: "CDPH/LHJ Population Task Force - Jaspreet Singh Kang"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r include=FALSE}

# Kniting Options
knitr::opts_chunk$set(eval = FALSE)
```

This system of data and RMarkdown file extracts and processes population data to generate data sets with sex-age-race/ethnicity estimates for all 58 California **counties**; the three city-based **local health jurisdictions (LHJs)** of Berkeley, Long Beach, and Pasadena; and the two respective county-less-city LHJs of Alameda LHJ and Los Angeles LHJ.

**The core concept is:**

1.  Get Department of Finance (DOF) county population data by year, by single year of age, sex, and race/ethnicity

2.  Get US Decennial census county and city population data for census years, by single year of age, sex, and race/ethnicity

    -   calculate city age-race-sex proportions of respective counties

3.  Apply these proportions to the DOF data to calculate age-race-sex population estimates for all local health jurisdictions and export population files

**Additional key concepts include:**

-   An optional step for adjusting DOF data to July 1 population rather than January 1

-   "Other" race is a category in the Decennial Census data but not in the other data sources. Therefore, "Other" race category data in the decennial census are redistributed to the other R/E categories.

Exported files (saved as both .RDS and .csv) in the finalPopData/ folder include:

-   lhj-population-ars, with variables:

    -   county_lhj

    -   year

    -   sex

    -   age

    -   raceEth

    -   population
    
-   lhj-population-ars-adjJuly

    - Same as lhj-population-ars, except population estimates are adjusted from January 1 to July 1 estimates.

These LHJ population data are generated by a series of R markdown files.  For technical users, the markdown files contain all code and supplemental documentation for the processes.  For general users, each markdown file generates an html file that provides a higher level description and documentation of the processes, including the intermediate and/or final output files generated.


Purpose of each file is described below:

**1a-Process-Historical-Raw-Data.Rmd:**  processes *historical* county- and city-level DOF (up-to 2010) and Census Decennial (2000, 2010) data. This file never needs to be executed again.

**1b-Process-Current-Raw-Data.Rmd:** processes *current* county- and city-level DOF (2010-2023) and Census Decennial (2020) data. This file must be maintained and re-executed whenever a new population data file (either from DOF or Census Decennial) is released.

**2-Create-LHJ-Population-Total.Rmd:** generates a data file with total July population estimates, which then is used in 3-Create-LHJ-Population-ARS.Rmd to adjust the DOF Jan 1st estimates to July 1st estimates. This Rmarkdown file must be executed only if the adjustment of DOF data is needed or desired.

**3-Create-LHJ-Population-ARS.Rmd** generates two final data files which contain single years of age by race/ethnicity by sex population estimates for LHJs from 2000-2023. One data file contains January 1st estimates whereas the other file contains adjusted July 1st estimates. Both files are saved as .csv and .RDS in finalPopData/:

- lhj-population-ars (contains some January 1st estimates)
- lhj-population-ars-adjJuly (adjusted to July 1st estimates)
